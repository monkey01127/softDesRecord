# 数据库系统

## 4.02 数据库模式

三级模式-两级映射一般是选择题

外模式（视图）

概念模式（DBA视图）

内模式（内部视图）

物理数据库

映射：外模式-概念模式映射， 概念模式-内模式映射

## 4.03 数据库设计过程

需求分析--> 概念结构设计（产出ER模型） --> 逻辑结构设计（产出关系模式） --> 物理设计

## 4.04 ER模型（必考）

* 方框：表示实体

* 椭圆：表示属性

* 菱形：表示联系

例如： 学生选课系统， 实体：学生，课程； 联系：选课；学生与课程之间是多对多的关系

集成的方法：

* 多个局部E-R一次集成

* 逐步集成，用累加的方式一次集成两个局部E-R

集成产生的冲突及解决办法：

属性冲突、命名冲突、结构冲突

一个实体型转换位一个关系模式

考选择，以及下午大题

## 4.05 关系代数余元组演算

*考点在综合题里出现*

基本运算包括：

并、交、差属于简单的集合运算

考点：笛卡尔积、投影、选择、联接

例如： 关系S1, S2

* 并∩: 合并 S1, S2, 保留一个公共部分

* 交∪：S1, S2, 保留两者的公共部分

* 差－：S1 - S2, S1中去掉S1, S2的公共部分

* 笛卡尔积X: S1 每条记录分别与S2的每条记录进行拼接
  属性总数为： S1属性数 + S2属性数
  记录数： S1记录数 * S2记录数

* 投影：选列操作

* 选择：选行操作

* 联接▷◁：相同的属性字段做等值

## 4.06 规范化理论（必考）

符号解释：=》 确定， ≠ 不能确定，不依赖

部分函数依赖

学号，课程号 =》 姓名， 学号 =》 姓名

传递函数依赖

A =》 B =》 c, 说明 A =》 C，并且 A ≠ B

#### 4.07 价值与用途

非规范理论存在的问题：数据冗余、更新异常、插入异常、删除异常

#### 4.08 键

* 超键： 唯一标识元祖， 可能存在多余属性

* 候选键：消除多余属性

* 主键： 任意一个候选键

* 外键： 其他关系的主键, 主要用于对表做关联

例如：

    学号、姓名两者为超键，不是候选键

    候选键可以有多个，但是主键只有一个

题目：求候选键方法

将关系模式的函数依赖关系用"有向图"的方式表示

找出入度为0的属性：没有一个箭头指向她，尝试遍历所有向图，正常遍历所有节点，则为候选键

若入度为0的节点不能遍历图中所有节点，则需要尝试让中间节点（有入度，有出度的节点）

### 4.09 范式（必考）

结合函数依赖，候选键来考

主属性： 属于候选键的一部分

非主属性： 不属于候选键的一部分

1NF: 属性值都是不可分的原子值

2NF：1NF -> 2NF 消除非主属性对候选键的部分依赖

3NF：2NF -> 3NF 消除非主属性对候选键的传递依赖

BCNF：3NF -> BCNF 消除主属性对候选键的传递依赖

第一范式（1NF）: 在高级模式R中，当且仅当所有域`只包含原子值`，即每个分量都是不可再分的数据线个，则称R是第一范式

第二范式（2NF）: 当且仅当1NF, 且每个`非主属性完全依赖主键`（不存在部分依赖）时，则称R是第二范式

第三范式（3NF）: 对于一个满足2nd NF 的数据结构来说，表中有可能存在某些数据元素依赖于其他非关键字数据元素的现象,必须消除。

BC范式（BCNF）：所有函数依赖写出，函数依赖的左边部分必须是候选键，左侧部分是决定性因数

### 4.10 规范化理论练习题（必考）

范式

### 4.11 规范化理论-模式分解（必考）

1.保持函数依赖的分解
    例如： R: A, B, C 函数依赖： A -> B, B -> C, R1(A, B), R2(B, C), R3(A, C), 其中R1, R2保持了函数依赖

2.无损分解：一个关系模式分解成若干个关系模式后，通过自然联接和投影等运算仍能还原到原来的关系模式

公式一份为2

R1 ∩ R2 = A

R1 - R2 = A

R2 - R1 = C

只要出现 A - > B 或者 A -> C 即为无损分解，否者为有损分解

## 4.12 并发控制

### 基本概念

> 事务：要不全做，要么全不做，保持一个状态，例如：银行转账

    * 原子性

    * 一致性

    * 隔离性

    * 持续性

并发产生的问题

    丢失更新

    不可重复都问题

    脏数据的读出

并发问题解决如下 :

1.封锁协议，同时产生问题如下：

    S封锁（读锁操作）， X封锁（写锁操作）

    一级封锁协议: 事务T在修改数据R之前必须先对其加X锁，知道实物结束才释放。可防止丢失修改。

    二级封锁协议：在一级封锁协议加上事务T在读取数据R之前先对其加S锁，读完后即可释放S锁。可防止丢失修改，还可以防止都"脏"数据

    三级封锁协议: 在一级封锁协议加上事务T在读取数据R之前先对其加S锁，直到事务结束才释放。可防止丢失修改，防止读"脏"数据与防止数据重复读

    两段锁协议: 可串行化的，可能发生死锁

    注：加S读锁S，还可以进行加S读，不可以加X写锁

2.死锁问题 ，同时产生问题如下

    预防法
    死锁的解除法

问题：

解决方案：

死锁：

## 4.13 数据库完整性约束

实体完整性约束

参照完整性约束

用户自定义完整性约束

触发性

## 4.14 数据库安全

用户标识和鉴定：最外层的安全保护措施，身份认证

存取控制：操作权限授权：例如 增，删，改，查以及数据对象（主要是数据范围）的权限

密码存储和传输：对远程终端信息用密码传输

视图的保护：对视图进行授权

审计：使用日志就行分析，将操作记录下来，方便日后就行分析

## 4.15 数据库恢复与备份

> 冷备份：静态备份，是将数据库正常关闭，在停止状态下，将数据库的文件全部备份（复制）下来

优点：快速；低维护；安全度

缺点：中断其它工作；收磁盘空间约束，可能需要其他外部存储器设备，速度变慢，不能按表或者按用户恢复

> 热备份：动态备份，是利用设备备份软件，在数据库正常运行的状态下，将数据库中的数据文件备份出来

优点：可按表空间或者文件级备份；时间短；数据库可使用；恢复到某一时间点上；几乎可对所有数据库做实体回复；恢复速度快

缺点：不能出错，必须一次成功，若出错不可用于时间点的恢复

> 完全备份：备份所有数据

> 差量备份：仅仅备份上一次`完全备份`之后变化的数据

> 增量备份：`备份上一次变化`之后变化的数据

例如：备份策略

周日：完全

周一：增量

周二：增量

周三：增量

周四：差异

周五：增量

周六：增量

转储： 做备份，把数据从A->B

海量：所有数据；增量：上次备份之后

静态`海量`转储：系统中`无`事务运行时，每次转储`全部`数据库

静态`增量`转储：系统中`无`事务运行时，每次转储`上次`数据库

动态`海量`转储：系统中`有`事务运行时，每次转储`全部`数据库

动态`增量`转储：系统中`有`事务运行时，每次转储`上次`数据库

日志文件：事务日志正对数据库改变所做的几率，它可以记录针对数据库的任何操作，并将记录结果保存在独立的文件中，日志文件比数据要先处理，记录

### 数据库的恢复与故障

事务本身`可预计`的故障: 在程序中预先设置Rollback语句

事务本身`不可预计`的故障: 通过DBMS系统通过日志，撤销修改，回退到事务初始状态

系统故障: 系统停止运转 检查点发

介质故障: 外存被破坏 一般使用日志重做业务

## 4.16 数据仓库与数据挖掘

数据仓库

数据挖掘

    分类：关联分析、序列模式分析、分类分析、聚类分析

    方法：决策树、神经网络、遗传算法、关联规划挖掘算法

## 4.17 反规范化技术

> 由于规范化会使表不断的拆分，导致数据表过去，表的颗粒度过小，引起了查询时的多表查询，增加了处理、查询时间

技术手段

    增加派生性冗余列、增加冗余列、重新组表、分割表

## 4.18 大数据基本概念

数据量大，关系复杂

大数据处理系统的应该具有的重要特征

 * 高度的可扩展性

 * 高性能

 * 高度容错

 * 支持异构环境

 * 较短的分析延迟

 * 艺用且开放的接口

 * 较低成本

 * 向下兼容

## 分布式数据库
